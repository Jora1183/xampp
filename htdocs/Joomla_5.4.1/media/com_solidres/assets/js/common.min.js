/*------------------------------------------------------------------------
 Solidres - Hotel booking extension for Joomla
 ------------------------------------------------------------------------
 @Author    Solidres Team
 @Website   https://www.solidres.com
 @copyright Copyright (C) 2013 Solidres. All Rights Reserved.
 @License   GNU General Public License version 3, or later
 ------------------------------------------------------------------------*/
function isAtLeastOneRoomSelected(){var e=0;Solidres.jQuery(".reservation_room_select").each(function(){var t=Solidres.jQuery(this);!t.is(":checked")||t.prop("disabled")||e++}),e>0?Solidres.jQuery('#sr-reservation-form-room button[type="submit"]').removeAttr("disabled"):Solidres.jQuery('#sr-reservation-form-room button[type="submit"]').attr("disabled","disabled")}Solidres.options={data:{},get:function(e,t){return void 0!==this.data[e.toUpperCase()]?this.data[e.toUpperCase()]:t},load:function(e){for(var t in e)this.data[t.toUpperCase()]=e[t];return this}},Solidres.sprintf=function(e){var t=1,a=arguments;return e.replace(/%s/g,function(){return a[t++]})},Solidres.printTable=function(e){nw=window.open(""),nw.document.write(e.outerHTML),nw.print(),nw.close()},Solidres.toggle=function(e,t){return"none"===e.style.display?e.style.display="":e.style.display="none",t&&(""===e.style.display?t.setAttribute("class","toggle_indicator float-end fa fa-subtract"):"none"===e.style.display&&t.setAttribute("class","toggle_indicator float-end fa fa-plus")),e};var isValidCheckInDate=function(e,t){return 0!=t.length&&Solidres.jQuery.inArray(e,t)>-1};function changeCheckButtonState(){document.querySelector('.sr-datepickers input[name="checkin"]').value&&document.querySelector('.sr-datepickers input[name="checkout"]').value?document.querySelector(".sr-datepickers .searchbtn").removeAttribute("disabled"):document.querySelector(".sr-datepickers .searchbtn").setAttribute("disabled","disabled")}function updateCheckinField(e,t){const a=Solidres.jQuery;a('.sr-datepickers input[name="checkin"]').val(a.datepicker.formatDate("yy-mm-dd",e)),a(".checkin_roomtype").removeAttr("readonly").val(a.datepicker.formatDate(t,e)).attr("readonly","readonly")}function updateCheckoutField(e,t){const a=Solidres.jQuery;a('.sr-datepickers input[name="checkout"]').val(a.datepicker.formatDate("yy-mm-dd",e)),a(".checkout_roomtype").removeAttr("readonly").val(a.datepicker.formatDate(t,e)).attr("readonly","readonly"),a(".apartment-form-holder").length&&a(".apartment-form-holder").find(".trigger_tariff_calculating").eq(0).trigger("change")}function getCheckInOutDates(e){const t=e[0],a=t.querySelector('input[name="checkin"]'),o=t.querySelector('input[name="checkout"]');Joomla.request({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=reservationasset.getCheckInOutDates&checkin="+a.value+"&checkout="+o.value+"&bookingType="+Joomla.getOptions("com_solidres.general").BookingType,method:"POST",onSuccess:function(e){const a=t.querySelector(".occupancy-status");a&&(a.style.display="block",a.innerHTML=e)}})}Solidres.validateCardForm=function(e){var t=Solidres.jQuery,a=e.parents("form"),o=e.data("element");if(e.hasClass("handled"))return!0;e.addClass("handled");var r={required:!0,creditcard:!0,creditcardtypes:e.data("acceptedCards")||{all:!0}},n={required:!0,number:!0},i={required:!0,lettersWithSpacesOnly:!0},s={required:!0,cardExpirationRule:!0};a.on("change","input.payment_method_radio",function(e){e.preventDefault();var d=a.find('[name="jform['+o+'][cardHolder]"]'),l=a.find('[name="jform['+o+'][cardNumber]"]'),c=a.find('[name="jform['+o+'][cardCvv]"]'),m=a.find('[name="sr_payment_'+o+'_expiration"]');t(this).is(":checked")&&this.value===o?(a.find(".payment_method_"+o+"_details").removeClass("nodisplay"),a.find(".payment_method_"+o+"_details input").attr("required",!0),a.find(".payment_method_"+o+"_details select").attr("required",!0),l.length&&l.rules("add",r),c.length&&c.rules("add",n),d.length&&d.rules("add",i),m.length&&m.rules("add",s)):(a.find(".payment_method_"+o+"_details").addClass("nodisplay"),a.find(".payment_method_"+o+"_details input").removeAttr("required"),a.find(".payment_method_"+o+"_details select").removeAttr("required"),l.length&&l.rules("remove"),c.length&&c.rules("remove"),d.length&&d.rules("remove"),m.length&&m.rules("remove"))})},document.addEventListener("DOMContentLoaded",function(e){const t=Solidres.jQuery;document.addEventListener("click",e=>{let t=e.target.closest(".toggle_section");if(t){let e=t.querySelector(".toggle_indicator"),a=t.dataset.toggleTarget;if(a&&"#"===a.substring(0,1))Solidres.toggle(document.getElementById(a.substring(1)),e);else{let t=document.getElementsByClassName(a.substring(1));for(let a=0;a<t.length;a++)Solidres.toggle(t[a],e)}}}),t.validator.methods.hasOwnProperty("lettersWithSpacesOnly")||t.validator.addMethod("lettersWithSpacesOnly",function(e,t){return this.optional(t)||/^[a-z\s]+$/i.test(e)},Joomla.Text._("SR_WARN_ONLY_LETTERS_N_SPACES_MSG","Letters and spaces only please")),t.validator.methods.hasOwnProperty("cardExpirationRule")||t.validator.addMethod("cardExpirationRule",function(e,a){if(!e.match(/^[0-9]{2}\/[0-9]{2}$/g))return!1;var o=t(a.form),r=new Date,n=e.split("/"),i=parseInt(n[0]),s=parseInt(r.getFullYear().toString().substring(0,2)+n[1]),d=parseInt(r.getFullYear().toString()),l=parseInt(r.getMonth().toString()),c=t(a).parents(".sr-payment-card-form-container").data("element");return!(i<1||i>12||s<d||s===d&&i<l+1)&&(o.find('[name="jform['+c+'][expiryMonth]"]').val(1===i.toString().length?"0"+i:i),o.find('[name="jform['+c+'][expiryYear]"]').val(s),!0)},Joomla.Text._("SR_WARN_INVALID_EXPIRATION_MSG","Your card's expiration year is invalid or in the past."));var a=function(){t(".sr-payment-card-form-container[data-accepted-cards]").each(function(){Solidres.validateCardForm(t(this))})};a(),t("#solidres").on("click",".reservation-navigate-back",function(e,a){t(".reservation-tab").removeClass("active"),t(".reservation-single-step-holder").removeClass("nodisplay").addClass("nodisplay");var o=t(this);if(void 0===a)var r=o.data("prevstep");else r=a;if(t("."+r).removeClass("nodisplay").find("button[type=submit]").removeAttr("disabled"),t(".reservation-tab").find("span.badge").removeClass("badge-info"),t(".reservation-tab-"+r).addClass("active").removeClass("complete"),t(".reservation-tab-"+r+" span.badge").removeClass("badge-success").addClass("badge-info"),document.getElementById("book-form").scrollIntoView(),t(".rooms-rates-summary.module").length){var n=t(".rooms-rates-summary.module");if(summarySidebarId)var i=n.parents(summarySidebarId);else i=n.parent();"room"==r||"guestinfo"==r?i.show():i.hide()}}),t(".confirmation").on("click","#termsandconditions",function(){var e=t(this),a=t(".confirmation").find("button[type=submit]");e.is(":checked")?a.removeAttr("disabled"):a.attr("disabled","disabled")}),t("#solidres .guestinfo").on("change",".country_select",function(){t.ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&format=json&task=states.find&id="+t(this).val(),success:function(e){t(".state_select").empty(),e.length>0&&t(".state_select").html(e)}})}),t("#solidres").on("change",".trigger_tariff_calculating",function(e,a){let o=t(this),r=o.data("raid"),n=o.data("roomtypeid"),i=o.data("roomindex"),s=o.data("roomid"),d=o.attr("data-tariffid"),l=o.parents(".apartment-form-holder").length?1:0,c=n+"_"+d+"_"+s;"frontend"==Solidres.context&&1!=Solidres.options.get("Hub_Dashboard")&&(c=n+"_"+d+"_"+i);let m=1;t("select.adults_number[data-identity='"+c+"']").length&&(m=t("select.adults_number[data-identity='"+c+"']").val());let u=0;t("select.children_number[data-identity='"+c+"']").length&&(u=t("select.children_number[data-identity='"+c+"']").val());let p=null;if(t("select.guests_number[data-identity='"+c+"']").length&&(p=t("select.guests_number[data-identity='"+c+"']").val()),null==a&&(a=!0),!a&&o.hasClass("reservation-form-child-quantity"))return;if(o.hasClass("reservation-form-child-quantity")&&u>=1)return;let f={};f.raid=r,f.room_type_id=n,f.room_index=i,f.room_id=s,f.adult_number=m,f.child_number=u,f.type=l,p&&(f.guest_number=p),t("input[name=checkin]").length&&(f.checkin=t("input[name=checkin]").val()),t("input[name=checkout].trigger_tariff_calculating").length&&(f.checkout=t("input[name=checkout].trigger_tariff_calculating").val()),f.tariff_id=d,f.extras=[];for(let e=0;e<u;e++){let a="child_age_"+c+"_"+e;t("."+a).val()&&(f[a]=t("."+a).val())}let h=t(".extras_row_roomtypeform_"+c+" input[type='checkbox']");h.length&&h.each(function(){if(this.checked){let e=t(this).attr("data-target");f[e]=t(this).parent().find("select#"+e).val(),f.extras.push(t(this).attr("data-extraid"))}}),t.ajax({type:"POST",url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=reservationasset"+("frontend"===Solidres.context?"":"base")+".calculateTariff&format=json",data:f,cache:!1,headers:{"X-CSRF-Token":Joomla.getOptions("csrf.token","")},success:function(e){const a=t(".breakdown_wrapper");if(a.length&&a.show(),!e.room_index_tariff)return;const o=t(".tariff_"+c);e.room_index_tariff.code||e.room_index_tariff.value?(o.length&&o.text(e.room_index_tariff.formatted),t("#breakdown_"+c).empty().html(e.room_index_tariff_breakdown_html)):o.length&&o.text("0")},dataType:"json"})}),t(document).on("click",".toggle_extracost_confirmation",function(){var e=t(".extracost_confirmation");t(this);e.toggle(),e.is(":hidden")?t(".extracost_row").removeClass().addClass("nobordered extracost_row"):t(".extracost_row").removeClass().addClass("nobordered extracost_row first")}),t("#solidres").on("change",".reservation-form-child-quantity",function(e,a){if(null==a&&(a=!0),!a)return;const o=t(this),r=o.val();let n="";const i=o.data("raid"),s=o.data("roomtypeid"),d=o.data("roomid"),l=o.data("roomindex"),c=o.data("tariffid");let m=o.parents(".occupancy-selection").find(".child-age-details");void 0!==m&&0!=m.length||(m=o.parents(".room_selection_details").find(".child-age-details")),r>0?(m.css("display","block"),m.parent()[0].scrollIntoView()):m.css("display","none");const u=Joomla.getOptions("com_solidres.general").ChildAgeMaxLimit;for(let e=0;e<r;e++){n+="<li>"+Joomla.Text._("SR_CHILD")+" "+(e+1)+' <select name="jform[room_types]['+s+"]["+c+"]["+("frontend"==Solidres.context&&1!=Solidres.options.get("Hub_Dashboard")?l:d)+"][children_ages]["+e+']" data-raid="'+i+'" data-roomtypeid="'+s+'" data-roomid="'+d+'" data-roomindex="'+l+'" data-tariffid="'+c+'" required class="form-select child_age_'+s+"_"+c+"_"+("frontend"==Solidres.context&&1!=Solidres.options.get("Hub_Dashboard")?l:d)+"_"+e+' trigger_tariff_calculating"> ',n+='<option value=""></option>';for(let e=0;e<=u;e++)n+='<option value="'+e+'">'+(e>1?e+" "+Joomla.Text._("SR_CHILD_AGE_SELECTION_JS"):e+" "+Joomla.Text._("SR_CHILD_AGE_SELECTION_1_JS"))+"</option>";n+="</select></li>"}m.find("ul").empty().append(n)});const o=function(e){let o=t(e),r=o.attr("action"),n=o.parent(".reservation-single-step-holder"),i=o.find("button[type=submit]"),s=i.data("step");i.attr("disabled","disabled"),i.html('<i class="fa fa-arrow-right"></i> '+Joomla.Text._("SR_PROCESSING"));const d=document.getElementById("book-form");d&&d.scrollIntoView(!0),t.post(r,o.serialize(),function(e){if(1==e.status){const r=Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=reservation"+("backend"==Solidres.context?"base":"")+".progress&next_step="+e.next_step;if(1==e.static){const a=t("#sr-reservation-form-confirmation");if("confirmation"==e.next_step){const e=t('#sr-apartment-captcha textarea[name="g-recaptcha-response"]');e.length&&a.append(e.clone().removeAttr("id"));const r=o.find('input[type="file"]');r.length&&(a.find('input[type="file"]').remove(),a.append(r.clone().addClass("hide").removeAttr("id"))),a.submit()}else location.href=e.redirection}t.ajax({type:"POST",cache:!1,url:r,headers:{"X-CSRF-Token":Joomla.getOptions("csrf.token","")},success:function(o){n.addClass("nodisplay"),i.removeClass("nodisplay"),i.hasClass("notxtsubs")||i.html('<i class="fa fa-arrow-right"></i> '+Joomla.Text._("SR_NEXT"));const r=t("."+e.next_step);r.removeClass("nodisplay").empty().append(o);[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(e){return new bootstrap.Popover(e)});"payment"==e.next&&t.metadata.setType("attr","validate"),location.hash="#book-form",t(".reservation-tab").removeClass("active"),t(".reservation-tab-"+s).addClass("complete"),t(".reservation-tab-"+s+" span.badge").removeClass("badge-info").addClass("badge-success"),t(".reservation-tab-"+e.next_step).addClass("active"),t(".reservation-tab-"+e.next_step+" span.badge").addClass("badge-info");const d=r.find("form.sr-reservation-form"),l=r.find("form#sr-reservation-form-confirmation");if("sr-reservation-form-guest"==d.attr("id")){const e=Joomla?.getOptions("com_solidres.property").ForceCustomerRegistration;d.validate({rules:{"jform[customer_email]":{required:!0,email:!0},"jform[customer_email2]":{equalTo:'[name="jform[customer_email]"]'},"jform[payment_method]":{required:!0},"jform[customer_password]":{require:!!e,minlength:8},"jform[customer_username]":{required:!!e,remote:{url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=user.check&format=json",type:"POST",data:{username:function(){return t("#username").val()}}}}},messages:{"jform[customer_username]":{remote:Joomla.Text._("SR_USERNAME_EXISTS")}}}),a(),d.find("input.payment_method_radio:checked").trigger("change"),d.find(".country_select").trigger("change"),"function"==typeof onSolidresAfterSubmitReservationForm&&onSolidresAfterSubmitReservationForm()}else d.validate();if(t(".rooms-rates-summary.module").length){const e=t(".rooms-rates-summary.module");let a=e.parent();summarySidebarId&&(a=e.parents(summarySidebarId)),l.length?a.hide():a.show()}}})}else if(e.captchaError){i.html('<i class="fa fa-arrow-right"></i> '+Joomla.Text._("SR_NEXT")).prop("disabled",!1);const a=t("#captcha-message").text(e.message);t("html, body").animate({scrollTop:a.offset().top},400)}},"json")};function r(){sum=0,t.each(t(".grand_total_sub"),function(){t(this).val()?sum+=parseFloat(t(this).val()):t(this).attr("val")&&(sum+=parseFloat(t(this).attr("val")))}),t(".grand_total").text(sum)}t("#solidres").on("submit","form.sr-reservation-form",function(e){e.preventDefault(),o(this)}),t("#solidres").on("submit","form#sr-reservation-form-confirmation",function(e){t(this).find("button[type='submit']").prop("disabled",!0);var a=t(this);a.find("#filesUpload").remove();var o=t('<div id="filesUpload" style="display:none!important"/>').appendTo(a),r=t('#sr-reservation-form-guest input[type="file"]');r.length&&r.each(function(){o.append(t(this).clone())})}),t("#solidres").on("click",".sr-field-remove-file",function(e){if(e.preventDefault(),confirm(Joomla.Text._("SR_CUSTOM_FIELD_CONFIRM_DELETE_UPLOAD_FILE","Are you sure you want to delete this file?"))){var a=t(this),o={file:a.attr("data-file")};o[a.attr("data-token")]=1,a.find(".fa-times").attr("class","fa fa-spin fa-spinner"),t.ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=customfield.deleteFile",type:"POST",dataType:"json",data:o,success:function(e){if(e.success){var o=t(a.attr("data-ref"));a.attr("data-required")&&o.addClass("required"),o.show(),a.parents(".sr-file-wrap").remove()}else a.find(".fa-spinner").attr("class","fa fa-times"),alert(e.message)}})}}),t(".roomtype-reserve-exclusive").click(function(){var e=t(this),a=e.data("tariffid"),r=e.data("rtid");t(".tariff-box .exclusive-hidden").prop("disabled",!0),t(".tariff-box .exclusive-hidden-"+r+"-"+a).prop("disabled",!1),t(".roomtype-quantity-selection.quantity_"+r).val("0"),t(".roomtype-quantity-selection.quantity_"+r).trigger("change"),o(document.getElementById("sr-reservation-form-room"))}),t.fn.srRoomType=function(e){e=t.extend({},e);var a=function(){t(".delete-room-row").unbind().click(function(){removeRoomRow(this)})};return a(),removeRoomRow=function(e){var a=t(e),o=a.next(),r=a.attr("id");o.addClass("ajax-loading"),null!=r?(roomId=r.substring(16),t.ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=roomtype"+("frontend"==Solidres.context?"frontend":"")+".checkRoomReservation&tmpl=component&format=json&id="+roomId,context:document.body,dataType:"JSON",success:function(e){o.removeClass("ajax-loading"),e?a.parent().parent().remove():(o.addClass("delete-room-row-error"),o.html(Joomla.Text._("SR_FIELD_ROOM_CAN_NOT_DELETE_ROOM")+' <a class="room-confirm-delete" data-roomid="'+roomId+'" href="#">Yes</a> | <a class="room-cancel-delete" href="#">No</a>'),t(".tier-room").on("click",".room-confirm-delete",function(){t.ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=roomtype"+("frontend"==Solidres.context?"frontend":"")+".removeRoomPermanently&tmpl=component&format=json&id="+roomId,context:document.body,dataType:"JSON",success:function(e){e&&a.parent().parent().remove()}})}),t(".tier-room").on("click",".room-cancel-delete",function(){o.html("")}))}})):a.parent().parent().remove()},initRoomRow=function(){var o=e.rowIdRoom,r="tier-room-"+o,n="";t("#room_tbl tbody").append('<tr id="'+r+'" class="tier-room"></tr>'),n+='<td><a class="delete-room-row btn btn-sm btn-secondary"><i class="fa fa-minus"></i></a></td>',n+='<td><input type="text" class="form-control" name="jform[rooms]['+o+'][label]" required />',n+='<input type="hidden" name="jform[rooms]['+o+'][id]" value="new" /></td>',t("#"+r).append(n),a()},t("#new-room-tier").click(function(t){t.preventDefault(),initRoomRow(),e.rowIdRoom++}),this},t("#solidres").on("change",".occupancy_max_constraint",function(){const e=t(this),a=e.data("max"),o=e.data("min"),r=e.data("roomtypeid"),n=e.data("roomindex"),i=e.data("roomid"),s=e.attr("data-tariffid");let d=0,l=0,c=i+"_"+s+"_"+r;"frontend"===Solidres.context&&(c=n+"_"+s+"_"+r);const m=t(".occupancy_max_constraint_"+c);if(a>0&&(m.each(function(){let e=t(this),a=parseInt(e.val());a>0&&(d+=a)}),l=a-d,m.each(function(){let e=t(this),a=parseInt(e.val()),o=0;o=a>0?a+l:l,disableOptions(e,o)})),o>0){let e=0;m.each(function(){let a=t(this),o=parseInt(a.val());o>0&&(e+=o)}),e<o?(t("#error_"+c).show(),m.addClass("warning"),t("#sr-reservation-form-room").length?t('#sr-reservation-form-room button[type="submit"]').attr("disabled","disabled"):t('.apartment-form-holder button[type="submit"]').attr("disabled","disabled")):(t("#error_"+c).hide(),m.removeClass("warning"),t("#sr-reservation-form-room").length?t('#sr-reservation-form-room button[type="submit"]').removeAttr("disabled","disabled"):t('.apartment-form-holder button[type="submit"]').removeAttr("disabled","disabled"))}}),t("#solidres").on("click",".reservation_room_select",function(){var e=t(this),a=t("#room_selection_details_"+e.val()),o=t("#room"+e.val()+" dl dt table"),r=t("#room"+e.val()+" dl dt label span");e.is(":checked")?(a.show(),o.show(),r.addClass("label-success"),a.find("select.tariff_selection").removeAttr("disabled"),a.find("input.guest_fullname").removeAttr("disabled"),a.find("select.adults_number").removeAttr("disabled"),a.find("select.children_number").removeAttr("disabled"),t("#room_selection_details_"+e.val()+" .extras_row_roomtypeform").each(function(){var e=t(this);e.find("input:checkbox").is(":checked")&&e.find("select").removeAttr("disabled")}),t("#room_selection_details_"+e.val()+" .extras_row_roomtypeform input:checkbox").trigger("change")):(a.hide(),o.hide(),r.removeClass("label-success"),a.find("select.tariff_selection").attr("disabled","disabled"),a.find("input.guest_fullname").attr("disabled","disabled"),a.find("select.adults_number").attr("disabled","disabled"),a.find("select.children_number").attr("disabled","disabled"),a.find("input:hidden").attr("disabled","disabled"),a.find(".extras_row_roomtypeform select").attr("disabled","disabled")),isAtLeastOneRoomSelected()}),t("#solidres").on("click",".room input:checkbox, .guestinfo input:checkbox, .sr-apartment-form input:checkbox",function(){var e=t(this),a=t("#"+e.data("target"));e.is(":checked")?(a.removeAttr("disabled"),a.trigger("change")):(a.attr("disabled","disabled"),a.trigger("change"))}),t("#solidres").on("change",".tariff_selection",function(){var e=t(this);if(""==e.val())return t("a.tariff_breakdown_"+e.data("roomid")).hide(),t("span.tariff_breakdown_"+e.data("roomid")).text("0"),!1;var a=e.parents(".room_selection_wrapper"),o=a.find('.room_selection_details input[type="text"]').not('[name^="jform[roomFields]"]'),r=a.find('.room_selection_details input[type="checkbox"]').not('[name^="jform[roomFields]"]'),n=a.find(".room_selection_details select").not('.tariff_selection, [name^="jform[roomFields]"]'),i=a.find("dt span"),s=a.find("dt a.toggle_breakdown"),d=a.find("dt span.breakdown"),l=a.find(".extras_row_roomtypeform"),c=a.find('.extras_row_roomtypeform input[type="hidden"]');o.attr("name",o.attr("name").replace(/^(jform\[room_types\])(\[[0-9]+\])(\[[-?0-9a-z]*\])(.*)$/,"$1$2["+e.val()+"]$4")),c.length>0&&c.attr("name",c.attr("name").replace(/^(jform\[room_types\])(\[[0-9]+\])(\[[0-9a-z]*\])(.*)$/,"$1$2["+e.val()+"]$4")),n.each(function(){var a=t(this);a.attr("name",a.attr("name").replace(/^(jform\[room_types\])(\[[0-9]+\])(\[[-?0-9a-z]*\])(.*)$/,"$1$2["+e.val()+"]$4")),a.attr("data-tariffid",e.val()),a.attr("data-identity")&&a.attr("data-identity",a.attr("data-identity").replace(/^([0-9]+)(_)([-?0-9a-z]*)(_)(.*)$/,"$1$2"+e.val()+"$4$5")),a.hasClass("extra_quantity")&&a.attr("id",a.attr("id").replace(/^([-?0-9a-z]+)(_)([0-9]+)(_)([-?0-9a-z]*)(_)([-?0-9a-z]*)(_)(.*)$/,"$1$2$3$4"+e.val()+"$6$7$8$9"))}),r.each(function(){t(this).removeAttr("disabled"),t(this).attr("data-target")&&t(this).attr("data-target",t(this).attr("data-target").replace(/^([a-z]+)(_)([0-9]+)(_)([-?0-9a-z]*)(_)(.*)$/,"$1$2$3$4"+e.val()+"$6$7"))}),s.attr("data-toggle-target",s.attr("data-toggle-target").replace(/^([0-9]+)(_)([0-9a-z]*)(_)(.*)$/,"$1$2"+e.val()+"$4$5")),d.attr("id",d.attr("id").replace(/^([a-z]+)(_)([0-9]+)(_)([-?0-9a-z]*)(_)(.*)$/,"$1$2$3$4"+e.val()+"$6$7")),i.each(function(){var a=t(this);a.attr("class",a.attr("class").replace(/^([a-z]+)(_)([0-9]+)(_)([-?0-9a-z]*)(_)(.*)$/,"$1$2$3$4"+e.val()+"$6$7"))}),""!=e.val()?t(".tariff_breakdown_"+e.data("roomid")).show():t(".tariff_breakdown_"+e.data("roomid")).hide(),l.length&&l.attr("id",l.attr("id").replace(/^([a-z]+)(_)([a-z]+)(_)([a-z]+)(_)([0-9]+)(_)([-?0-9a-z]*)(_)(.*)$/,"$1$2$3$4$5$6$7$8"+e.val()+"$10$11")),t("#room"+e.data("roomid")+" .adults_number.trigger_tariff_calculating").trigger("change")}),t("#solidres").on("change paste keyup","#sr-reservation-form-confirmation .total_price_tax_excl_single_line",function(){var e=0;t.each(t(".total_price_tax_excl_single_line"),function(){e+=parseFloat(""!=t(this).val()?t(this).val():0)}),t(".total_price_tax_excl").text(e),r()}),t("#solidres").on("change paste keyup","#sr-reservation-form-confirmation .room_price_tax_amount_single_line",function(){var e=0;t.each(t(".room_price_tax_amount_single_line"),function(){e+=parseFloat(""!=t(this).val()?t(this).val():0)}),t(".tax_amount").val(e),r()}),t("#solidres").on("change paste keyup","#sr-reservation-form-confirmation .tax_amount",function(){r()}),t("#solidres").on("change paste keyup","#sr-reservation-form-confirmation .extra_price_single_line",function(){var e=0;t.each(t(".extra_price_single_line"),function(){e+=parseFloat(""!=t(this).val()?t(this).val():0)}),t(".total_extra_price").text(e),r()}),t("#solidres").on("change paste keyup","#sr-reservation-form-confirmation .extra_tax_single_line",function(){var e=0;t.each(t(".extra_tax_single_line"),function(){e+=parseFloat(""!=t(this).val()?t(this).val():0)}),t(".total_extra_tax").text(e),r()}),t("#solidres").on("change paste keyup","#sr-reservation-form-confirmation .total_discount",function(){t.each(t(".total_discount"),function(){parseFloat(""!=t(this).val()?t(this).val():0)}),r()});const n=document.getElementById("reservationnote-form");n&&n.addEventListener("submit",function(e){const t=n.action,a=n.querySelector("button[type=submit]"),o=n.querySelector("div.processing");a.disabled=!0,a.classList.add("nodisplay"),o.classList.remove("nodisplay"),o.classList.add("active"),Joomla.request({url:t,method:"POST",data:new FormData(n),perform:!0,onSuccess:e=>{let t=JSON.parse(e);a.classList.remove("nodisplay"),a.disabled=!1,o.classList.add("nodisplay"),o.classList.remove("active");document.getElementById("reservation-note-holder").insertAdjacentHTML("beforeend",t.note_html),n.querySelector("textarea").value="",n.querySelector('input[type="checkbox"]').checked=!1,n.querySelector('input[type="file"]')&&(n.querySelector('input[type="file"]').value="")},onError:()=>{}}),e.preventDefault()}),t("#solidres .room").on("change",".extras_row_roomtypeform input:checkbox",function(){var e=t(this),a=e.data("extraid");parent=e.parents(".room-form-item").find(".assigned-extra"),e.is(":checked")&&parent.hasClass("extra-"+a)?parent.show():!e.is(":checked")&&parent.hasClass("extra-"+a)&&parent.hide()});t("#solidres").on("change",".reload-sum",function(){var e,a,o;e=document.getElementById("sr-reservation-form-guest"),a=t(e),o=a.attr("action"),t.post(o,a.serialize()+"&jform[reloadSum]=1",function(e){1==e.status&&""==e.next_step&&Solidres.getSummary()},"json")}),t(".toggle-discount-sub-lines").click(function(){t(this).siblings(".sub-line-item").toggle()}),t.validator.setDefaults({errorPlacement:function(e,t){t.parents("[data-fieldset-group]").length?e.insertAfter(t.parents("[data-fieldset-group]")):e.insertAfter(t)}})}),Solidres.placeHolder=function(e,t){var a,o=Solidres.jQuery,r=(e=o(e||"#solidres")).find("[sr-placeholder-item]"),n=e.find(".sr-placeholder-wrap");r.length?"show"===t&&(r.html(function(){return'<div class="sr-placeholder">'+o(this).html()+"</div>"}).find(".sr-placeholder").each(function(){(a=o(this)).find(">img").length?a.css({position:"relative",textAlign:"center",display:"block",padding:"25px 0",marginBottom:5}).html('<i class="fa fa-image" style="font-size: 50px; color: #ddd; margin: auto;"></i>'):a.html(function(){return'<div style="visibility: hidden">'+o(this).html()+"</div>"})}),e.find(".sr-placeholder-hidden").hide()):(n.length||(n=o('<div class="sr-placeholder-wrap" style="display: none; position: relative; width: 100%;"><div class="sr-placeholder" style="width: 100%; height: 70px;"></div><div class="sr-placeholder" style="position: absolute; left: 0; top: 5px; right: 0; width: 98%; height: 58px; margin: auto; text-align: center;"><i class="fa fa-image" style="font-size: 50px; color: #ddd; margin-top: 5px;"></i></div><div class="sr-placeholder" style="display: block; margin-bottom: 5px; width: 50%; height: 15px;"></div><div class="sr-placeholder" style="width: 50%; height: 15px;"></div></div>'),e.append(n)),"show"===t?e.html(n.show()):"hide"===t&&n.hide())},Solidres.getSummary=function(){var e=Solidres.jQuery,t=e(".rooms-rates-summary.module"),a=e(".rooms-rates-summary-sticky"),o=t.hasClass("apartment_view");e.ajax({type:"GET",cache:!1,url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=reservation"+("backend"==Solidres.context?"base":"")+".getSummary&type="+(o?1:0),beforeSend:function(){t.remove(".sticky-loading").append(e('<div class="sticky-loading"></div>'));var o=a.parent().width()-parseInt(a.css("padding-left"))-parseInt(a.css("padding-right")),r=t.height();e(".sticky-loading").css({width:o,height:r})},complete:function(){t.remove(".sticky-loading")},success:function(a){t.empty().append(a),e.ajax({type:"GET",cache:!1,url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=reservation"+("backend"==Solidres.context?"base":"")+".getOverviewCost&format=json",success:function(t){e(".overview-cost-grandtotal").empty().append(t.grand_total)}})}})},Solidres.loadingLayer=function(e=!0){if(e)document.body.appendChild(document.createElement("joomla-core-loader"));else{const e=document.querySelector("joomla-core-loader");e.parentNode.removeChild(e)}},Solidres.initAgeFields=function(e){const t=e.getElementsByClassName("form-select-occupancy-child");if(t)for(let a=0;a<t.length;a++)t[a].addEventListener("change",function(t){let a=t.target.value;const o=e.getElementsByClassName(t.target.id);for(let e=0;e<o.length;e++){o[e].style.display="none";let t=o[e].getElementsByTagName("select");t[0].setAttribute("disabled","disabled"),t[0].removeAttribute("required")}for(let o=1;o<=a;o++){let a=e.getElementsByClassName(t.target.id+"_"+o)[0],r=a.getElementsByTagName("select");a.style.display="block",r[0].removeAttribute("disabled"),r[0].required=!0,r[0].addEventListener("change",function(){let e=r[0].closest(".child-ages-validation").getElementsByClassName("child-age-validation-ordering"),t=[];for(let a=0;a<e.length;a++)e[a].value&&t.push(parseInt(e[a].value));if(!t.every(isSortedDesc)){alert(Joomla.Text._("SR_CHILD_AGE_DESC_ORDER_REQUIRED"));for(let t=0;t<e.length;t++)e[t].value=""}})}}),t[a].dispatchEvent(new Event("change"))};const isSortedDesc=(e,t,{[t-1]:a})=>!t||a>=e;function disableOptions(e,t){const a=Solidres.jQuery;a("option",e).each(function(){parseInt(a(this).attr("value"))>t?a(this).attr("disabled","disabled"):a(this).removeAttr("disabled")})}Solidres.initDatePickers=function(e,t,a,o,r="",n="",i=!1,s=[],d=[]){const l=Solidres.jQuery,c=Joomla.getOptions("com_solidres.general"),m=c.hasOwnProperty("InlineDefaultLOS")?c.InlineDefaultLOS:c.MinLengthOfStay,u=c.MinDaysBookInAdvance,p=c.MaxDaysBookInAdvance,f=c.DateFormatJS,h=l("#"+e);0===r.length&&(r=u),0===n.length&&(n=p);const _=h.find(".checkout_datepicker_inline_module").datepicker({minDate:"number"==typeof t?"+"+t+"d":new Date(Date.parse(t)),numberOfMonths:c.DatePickerMonthNum,showButtonPanel:!0,dateFormat:f,firstDay:c.WeekStartDay,defaultDate:o.length>0?new Date(Date.parse(o)):null,onSelect:function(){h.find('input[name="checkout"]').val(l.datepicker.formatDate("yy-mm-dd",l(this).datepicker("getDate"))),h.find(".checkout_module").removeAttr("readonly").val(l.datepicker.formatDate(f,l(this).datepicker("getDate"))).attr("readonly","readonly"),h.find(".checkout_datepicker_inline_module").slideToggle(),h.find(".checkin_module").removeClass("disabledCalendar"),1===c.EnableUnoccupiedPricing&&i&&getCheckInOutDates(h)}});h.find(".checkin_datepicker_inline_module").datepicker({minDate:"number"==typeof r?"+"+r+"d":new Date(Date.parse(r)),maxDate:"number"==typeof n&&n>0?"+"+p:n.length>0?new Date(Date.parse(n)):null,numberOfMonths:c.DatePickerMonthNum,showButtonPanel:!0,dateFormat:f,firstDay:c.WeekStartDay,defaultDate:a.length>0?new Date(Date.parse(a)):null,onSelect:function(){var e=l(this).datepicker("getDate"),t=l(this).datepicker("getDate","+1d");t.setDate(t.getDate()+m),_.datepicker("option","minDate",t),_.datepicker("setDate",t),h.find('input[name="checkin"]').val(l.datepicker.formatDate("yy-mm-dd",e)),h.find('input[name="checkout"]').val(l.datepicker.formatDate("yy-mm-dd",t)),h.find(".checkin_module").removeAttr("readonly").val(l.datepicker.formatDate(f,e)).attr("readonly","readonly"),h.find(".checkout_module").removeAttr("readonly").val(l.datepicker.formatDate(f,t)).attr("readonly","readonly"),h.find(".checkin_datepicker_inline_module").slideToggle(),h.find(".checkout_module").removeClass("disabledCalendar"),1===c.EnableUnoccupiedPricing&&i&&getCheckInOutDates(h)},beforeShowDay:function(e){if(0===s.length&&0===d.length)return[!0,"bookable"];let t=e.getDay(),a=l.datepicker.formatDate("yy-mm-dd",e);return isValidCheckInDate(t,s)||d.indexOf(a)>-1?[!0,"bookable"]:[!1,"notbookable"]}});l(".ui-datepicker").addClass("notranslate"),h.find(".checkin_module").click(function(){l(this).hasClass("disabledCalendar")||h.find(".checkin_datepicker_inline_module").slideToggle("fast",function(){l(this).is(":hidden")?h.find(".checkout_module").removeClass("disabledCalendar"):h.find(".checkout_module").addClass("disabledCalendar")})}),h.find(".checkout_module").click(function(){l(this).hasClass("disabledCalendar")||h.find(".checkout_datepicker_inline_module").slideToggle("fast",function(){l(this).is(":hidden")?h.find(".checkin_module").removeClass("disabledCalendar"):h.find(".checkin_module").addClass("disabledCalendar")})}),h.find(".room_quantity").change(function(){let e=l(this).val();h.find(".room_num_row").each(function(t){let a=t+1;a<=e?(h.find("#room_num_row_"+a).show(),h.find("#room_num_row_"+a+" select.form-select-occupancy").removeAttr("disabled")):(h.find("#room_num_row_"+a).hide(),h.find("#room_num_row_"+a+" select.form-select-occupancy").attr("disabled","disabled"))})}),h.find(".room_quantity").val()>0&&h.find(".room_quantity").trigger("change"),1===c.EnableUnoccupiedPricing&&s&&getCheckInOutDates(h)};