/**
 ------------------------------------------------------------------------
 SOLIDRES - Accommodation booking extension for Joomla
 ------------------------------------------------------------------------
 * @author    Solidres Team <contact@solidres.com>
 * @website   https://www.solidres.com
 * @copyright Copyright (C) 2013 Solidres. All Rights Reserved.
 * @license   GNU General Public License version 3, or later
 ------------------------------------------------------------------------
 */
if(void 0===Solidres)var Solidres={};function isAtLeastOnRoomTypeSelected(){var e=0;Solidres.jQuery(".room-form").each(function(){Solidres.jQuery(this).children().length>0&&e++}),e>0?Solidres.jQuery('#sr-reservation-form-room button[type="submit"]').removeAttr("disabled"):Solidres.jQuery('#sr-reservation-form-room button[type="submit"]').attr("disabled","disabled")}function isElVisible(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}Solidres.context="frontend",Solidres.setCurrency=function(e){Solidres.jQuery.ajax({type:"POST",url:window.location.pathname,data:"option=com_solidres&format=json&task=currency.setId&id="+parseInt(e),success:function(e){location.reload()}})},document.addEventListener("DOMContentLoaded",function(){document.getElementById("coupon-code-check")?.addEventListener("click",function(e){const t=document.getElementById("coupon_code")?.value,o=document.querySelector('input[name="id"]')?.value;t&&o&&Joomla.request({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=coupon.validate&format=json",method:"POST",data:`code=${t}&pid=${o}`,onSuccess:function(e){const t=JSON.parse(e);document.getElementById("property-coupon-msg")?.remove();document.getElementById("property-coupon-form").insertAdjacentHTML("beforeend",t.message);const o=document.getElementById("coupon-code-apply");t.status?o.removeAttribute("disabled"):o.disabled=!0,o.addEventListener("click",function(){const e=document.getElementById("coupon_code").value,t=document.querySelector('input[name="id"]')?.value;e&&t&&Joomla.request({method:"POST",url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=coupon.apply&format=json",data:`code=${e}&pid=${t}`,onSuccess:function(e){JSON.parse(e).status&&location.reload()}})})}})}),document.getElementById("coupon-code-remove")?.addEventListener("click",function(e){Joomla.request({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=coupon.remove&format=json",method:"POST",onSuccess:function(e){JSON.parse(e).status?location.reload():alert(Joomla.Text._("SR_CAN_NOT_REMOVE_COUPON"))}})});let e=document.getElementsByClassName("load-calendar");for(let t=0;t<e.length;t++)e[t].addEventListener("click",function(){let e=this.dataset.roomtypeid,t=document.getElementById(`availability-calendar-${e}`);this.innerHTML='<i class="fa fa-calendar"></i> '+Joomla.Text._("SR_PROCESSING"),this.disabled=!0,0===t.children.length?Joomla.request({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=reservationasset.getAvailabilityCalendar&id="+e,method:"POST",onSuccess:e=>{this.removeAttribute("disabled"),e.length>0&&(t.style.display="",t.innerHTML=e,this.innerHTML='<i class="fa fa-calendar"></i> '+Joomla.Text._("SR_AVAILABILITY_CALENDAR_CLOSE"))}}):(t.replaceChildren(),t.style.display="none",this.innerHTML='<i class="fa fa-calendar"></i> '+Joomla.Text._("SR_AVAILABILITY_CALENDAR_VIEW"),this.removeAttribute("disabled"));const o=document.getElementById(`more_desc_${e}`);if(o&&isElVisible(o)){o.style.display="none";o.parentElement.querySelector(".toggle_more_desc").innerHTML='<i class="fa fa-eye-slash"></i> '+Joomla.Text._("SR_SHOW_MORE_INFO")}});const t=document.getElementById("apartment-rateplan-picker");t&&(t.addEventListener("change",function(e){let t=e.currentTarget.value,o=Joomla.getOptions("com_solidres.apartment").roomTypeId;if(t){const e=document.getElementById("apartment-form-holder");e.replaceChildren();const a=new FormData;a.append("Itemid",Joomla.getOptions("com_solidres.apartment").itemId),a.append("id",Joomla.getOptions("com_solidres.apartment").propertyId),a.append("roomtype_id",o),a.append("tariff_id",t),a.append("type",1),Joomla.request({method:"POST",data:a,url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=reservationasset.getCheckInOutForm",onSuccess:function(t){Solidres.jQuery("#apartment-form-holder").html(t);let o=e.querySelector('button[type="button"]');o.setAttribute("type","submit"),o.removeAttribute("disabled"),e.querySelector(".trigger_tariff_calculating").dispatchEvent(new Event("change",{bubbles:!0}))}})}}),t.dispatchEvent(new Event("change")))}),Solidres.jQuery(function(e){function t(t){const o=t.data("rtid"),a=t.data("raid"),s=t.data("tariffid"),i=e("#solidres .room #room-form-"+o+"-"+s),r=Joomla.getOptions("csrf.token","");e.ajax({type:"POST",url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=reservationasset.getRoomTypeForm",data:{rtid:o,raid:a,tariffid:s,quantity:t.val()>0?t.val():1},headers:{"X-CSRF-Token":r},success:function(o){t.parent().find(".processing").css({display:"none"}),i.empty().show().html(o),e(".sr-reservation-form").validate();let a=!1,s=parseInt(i.find(".children_number").val()),r=i.find(".child-age-details > ul").html().trim();1===s&&0===r.length&&(a=!0),i.find(".trigger_tariff_calculating").trigger("change",[a]),isAtLeastOnRoomTypeSelected(),i.find(".extras_row_roomtypeform input:checkbox").trigger("change")}})}function o(t,o,a){e("option",t).each(function(){var t=parseInt(e(this).attr("value"));t>=o&&t<=a?e(this).removeAttr("disabled"):e(this).attr("disabled","disabled"),0==t&&e(this).removeAttr("disabled")})}function a(){let e=document.getElementsByClassName("checkinoutform");for(let t=0;t<e.length;t++)e[t].replaceChildren()}document.getElementById("sr-reservation-form-room")&&e("#sr-reservation-form-room").validate(),document.getElementById("sr-checkavailability-form")&&e("#sr-checkavailability-form").validate(),e(".roomtype-quantity-selection").change(function(){isAtLeastOnRoomTypeSelected()}),document.getElementById("sr-availability-form")&&e("#sr-availability-form").validate(),e(".roomtype-quantity-selection").each(function(){var o=e(this);o.val()>0&&(o.parent().find(".processing").css({display:"block"}),e("#selected_tariff_"+o.data("rtid")+"_"+o.data("tariffid")).removeAttr("disabled"),t(o))}),e(".roomtype-quantity-selection").change(function(){var a,s=e(this),i=s.data("tariffid"),r=s.data("rtid"),n=s.data("totalroomsleft"),d=s.data("isprivate"),l=parseInt(s.val()),c=0;l>0?(s.parent().find(".processing").css({display:"block"}),e("#selected_tariff_"+r+"_"+i).removeAttr("disabled"),t(s),e("#tariff-holder-"+r+" .exclusive-hidden").prop("disabled",!0)):(e("#room-form-"+r+"-"+i).empty().hide(),e('input[name="jform[selected_tariffs]['+r+']"]').attr("disabled","disabled"),e("#selected_tariff_"+r+"_"+i).attr("disabled","disabled"),isAtLeastOnRoomTypeSelected()),e(".quantity_"+r).each(function(){var t=e(this),o=parseInt(t.val());o>0&&(c+=o)}),a=n-c,e(".quantity_"+r).each(function(){var t,s=e(this),i=parseInt(s.val()),r=s.data("qmin"),n=s.data("qmax");r>0&&n>0?a>=n?o(s,t=r,n):a<n&&a>=r?o(s,t=r,i>0?i+a>n?n:i+a:a):i>0?o(s,t=r,i+a>n?n:i+a):(t=a<r?i:i+a,disableOptions(s,t)):(t=i+a,disableOptions(s,t))});var m=e("#num_rooms_available_msg_"+r);a>0&&a<n?m.empty().text(Joomla.Text._("SR_ONLY_"+a+"_LEFT"+(d?"":"_BED"))):0==a?m.empty():m.empty().text(e("#num_rooms_available_msg_"+r).data("original-text"))}),e(".roomtype-reserve").click(function(){var o=e(this),a=o.data("tariffid"),s=o.data("rtid");0==e("#room-form-"+s+"-"+a).children().length?(e("#room_type_row_"+s+" .room-form").empty().hide(),o.siblings(".processing").css({display:"block"}),e("#selected_tariff_"+s+"_"+a).removeAttr("disabled"),t(o)):(e("#room-form-"+s+"-"+a).empty().hide(),e('input[name="jform[selected_tariffs]['+s+']"]').attr("disabled","disabled"),e("#selected_tariff_"+s+"_"+a).attr("disabled","disabled")),isAtLeastOnRoomTypeSelected()}),e(".guestinfo").on("click","input:checkbox",function(){var t=e(this);t.is(":checked")?e("."+t.data("target")).removeAttr("disabled"):e("."+t.data("target")).attr("disabled","disabled")}),e(".room-form").on("click","input:checkbox",function(){var t=e(this);t.is(":checked")?e("."+t.data("target")).removeAttr("disabled"):e("."+t.data("target")).attr("disabled","disabled")});let s=document.getElementsByClassName("trigger_checkinoutform");for(let y=0;y<s.length;y++)s[y].addEventListener("click",function(){let t=this.dataset.tariffid,o=this.dataset.roomtypeid,s=this.textContent;if(""!=t){a(),this.textContent=Joomla.Text._("SR_PROCESSING");const i=new FormData;i.append("Itemid",this.dataset.itemid),i.append("id",this.dataset.assetid),i.append("roomtype_id",o),i.append("tariff_id",t),Joomla.request({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_solidres&task=reservationasset.getCheckInOutForm",method:"POST",data:i,onSuccess:i=>{a(),e(`#checkinoutform-${o}-${t}`).show().empty().html(i),this.textContent=s}})}});e("#solidres").on("click",".searchbtn",function(){const t=e(this).data("tariffid"),o=e(this).data("roomtypeid"),a=e("#sr-checkavailability-form-component"),s="#tariff-box-"+o+"-"+t,i=e(s);if(1===Joomla.getOptions("com_solidres.general").AutoScroll){let e=s;0===Joomla.getOptions("com_solidres.general").AutoScrollTariff&&(e="#srt_"+o),a.attr("action",a.attr("action")+e)}if(a.find("input[name=checkin]").val(i.find('input[name="checkin"]').val()),a.find("input[name=checkout]").val(i.find('input[name="checkout"]').val()),a.find("input[name=ts]").val(e("input[name=fts]").val()),1===Joomla.getOptions("com_solidres.general").EnableUnoccupiedPricing){let t=document.querySelectorAll(s+' input[name="occupied_dates[]"]:checked');for(let o=0;o<t.length;o++)e("<input>",{type:"hidden",name:"occupied_dates[]",value:t[o].value}).appendTo(a)}a.submit()}),e(".toggle_more_desc").click(function(){var t=e(this);e("#more_desc_"+t.data("target")).toggle(),e("#more_desc_"+t.data("target")).is(":visible")?t.empty().html('<i class="fa fa-eye"></i> '+Joomla.Text._("SR_HIDE_MORE_INFO")):t.empty().html('<i class="fa fa-eye-slash"></i> '+Joomla.Text._("SR_SHOW_MORE_INFO"))}),e("#solidres").on("click",".checkin_roomtype",function(){e(this).hasClass("disabledCalendar")||e(".checkin_datepicker_inline").slideToggle()}),e("#solidres").on("click",".checkout_roomtype",function(){e(this).hasClass("disabledCalendar")||e(".checkout_datepicker_inline").slideToggle()}),e("#solidres").on("click","#register_an_account_form",function(){var t=e(this);t.parents("form").find('button[data-step="guestinfo"]').prop("disabled",!1),t.is(":checked")?e("."+t.attr("id")).show():e("."+t.attr("id")).hide()}),e(".toggle-tariffs").click(function(){var t=e(this),o=t.data("roomtypeid"),a=e("#tariff-holder-"+o);e("#more_desc_"+o).is(":visible")&&(e("#more_desc_"+o).hide(),t.parent().find(".toggle_more_desc").empty().html('<i class="fa fa-eye-slash"></i> '+Joomla.Text._("SR_SHOW_MORE_INFO"))),e("#availability-calendar-"+o).is(":visible")&&(e("#availability-calendar-"+o).empty().hide(),t.parent().find(".load-calendar").empty().html('<i class="fa fa-calendar"></i> '+Joomla.Text._("SR_AVAILABILITY_CALENDAR_VIEW"))),a.toggle(),a.is(":hidden")?t.html('<i class="fa fa-expand"></i> '+Joomla.Text._("SR_SHOW_TARIFFS")):t.html('<i class="fa fa-compress"></i> '+Joomla.Text._("SR_HIDE_TARIFFS"))});var i=location.hash;if(i.indexOf("tariff-box")>-1){var r=e(i),n=r.css("backgroundColor"),d=r.data("targetcolor");r.css("backgroundColor","#"+d),setTimeout(function(){r.css("backgroundColor",n)},1500)}if(e("html").click(function(t){e(t.target).hasClass("datefield")||e(t.target).parent().hasClass("datefield")||0!=e(t.target).closest("div.ui-datepicker").length||0!=e(t.target).closest("a.ui-datepicker-prev").length||0!=e(t.target).closest("a.ui-datepicker-next").length||0!=e(t.target).closest("div.ui-datepicker-buttonpane").length||e(".datepicker_inline").hide()}),e("#show-other-roomtypes").click(function(){e(".room_type_row").each(function(){e(this).hasClass("prioritizing")||e(this).toggle()}),e(".prioritizing-roomtype-notice").hide()}),e(".guestinfo").on("click",'button[data-step="guestinfo"]',function(t){var o=e("#privacy-consent"),a=e(this);if(o.length&&e("#register_an_account_form").is(":checked")&&!o.is(":checked"))return t.preventDefault(),t.stopPropagation(),o.parent("label").addClass("error"),e("html, body").animate({scrollTop:e("#register_an_account_form").offset().top},400),a.prop("disabled",!0),!1;a.prop("disabled",!1),o.parent("label").removeClass("error")}),e(".guestinfo").on("change","#privacy-consent",function(){e(this).parents("form").find('button[data-step="guestinfo"]').prop("disabled",!e(this).is(":checked"))}),e(".rooms-rates-summary.module").length){var l=e(".rooms-rates-summary.module"),c=e("#solidres");if((u={}).pos=l.offset().top,u.pos_bottom=1e3,c&&(u.pos_bottom=c.outerHeight()),summarySidebarId){var m=l.parents(summarySidebarId);u.width=m.width()-parseInt(l.css("padding-left"))-parseInt(l.css("padding-right"))}else{m=l.parent();u.width=m.width()-parseInt(l.css("padding-left"))-parseInt(l.css("padding-right"))}function p(){e(window).scrollTop()>=u.pos&&e(window).scrollTop()<u.pos_bottom?(m.addClass("rooms-rates-summary-sticky"),m.css({width:u.width})):m.removeClass("rooms-rates-summary-sticky")}e(window).scroll(u,p),window.addEventListener("resize",function(t){var o=e(".rooms-rates-summary.module"),a={};a.pos=o.offset().top,a.width=m.width()-parseInt(o.css("padding-left"))-parseInt(o.css("padding-right")),e(window).off("scroll",p),e(window).scroll(a,p)})}if(e(".booking-summary a.open-overlay").click(function(){m.removeClass("rooms-rates-summary-sticky"),l.addClass("sr-overlay"),e(".sr-close-overlay").show()}),e(".sr-apartment-form").length){var f=e(".sr-apartment-form"),u=(c=e("#solidres"),{}),h=e(".sr-gallery");u.pos=f.offset().top,u.pos_bottom=1e3,c&&(u.pos_bottom=c.outerHeight()),h.length&&(u.pos+=h.offset().top);var g=f.parents(".sr-apartment-aside");function p(){e(window).scrollTop()>=u.pos&&e(window).scrollTop()<u.pos_bottom?(g.addClass("rooms-rates-summary-sticky"),g.css({width:u.width})):g.removeClass("rooms-rates-summary-sticky")}u.width=g.width()-parseInt(f.css("padding-left"))-parseInt(f.css("padding-right")),e(window).scroll(u,p),window.addEventListener("resize",function(t){var o=e(".sr-apartment-form"),a={};a.pos=o.offset().top,a.width=g.width()-parseInt(o.css("padding-left"))-parseInt(o.css("padding-right")),e(window).off("scroll",p),e(window).scroll(a,p)})}e(".booking-summary a.open-overlay-apartment").click(function(){g.removeClass("rooms-rates-summary-sticky"),f.addClass("sr-overlay"),e(".sr-close-overlay").show(),e(".sr-apartment-form h3").show()}),e(document).on("click",".sr-close-overlay",function(){l&&(l.removeClass("sr-overlay"),e(this).hide()),f&&(f.removeClass("sr-overlay"),e(this).hide())}),e(document).on("click",".summary_edit_room",function(){var t=e(this).data("target");e(".reservation-navigate-back").trigger("click",["room"]),e("#tariff-box-"+t).length>0&&e("html, body").animate({scrollTop:e("#tariff-box-"+t).offset().top},700)})});